# 项目介绍、问题和优化方案

## 介绍

### 1.云动重庆

这个项目是我和工作室的朋友一起完成的一个商业项目，它是一个马拉松比赛的报名系统。该项目分为小程序和后台管理端两部分、主要的技术栈是 **react** 和 **taro**，我主要实现的是小程序的首页比赛信息展示和信息搜索功能，还有管理端的团队信息列表展示和赛事创建等功能。在这个项目中我实现了小程序的首页 **图片懒加载、搜索优化的上拉加载下拉刷新** 和管理端的 **大文件上传、续传和团队信息列表分页** 等功能点。

### 2.WeGoFit

这个项目也是我和朋友一起组队参加的一个小程序比赛，我们因为都喜欢运动所以打算做一个运动社区这样的小程序。该项目主要技术栈是 **taro** ，我主要实现的是 **匹配附近活动、成员聊天室和小程序登录授权** 的功能。

## 问题和解决

### 1.文件上传

切片计算MD5浪费时间，文件过大会造成页面假死？

可以设定最大文件值，可以利用web-worker进行脱离主线程的计算方式。

### 2.子组件无法获得父组件异步请求的值

父组件的异步获取数据通过props传递给子组件，弹窗子组件在didmount获取并setState更新state，但子组件没有显示数据？

因为子组件在父组件之后挂载已经执行didmount生命周期，而异步请求后props更新需要子组件通过**componentWillReceiveProps**来获取，但因为这个生命周期已经不安全而被弃用，可以使用**getDerivedStateFromProp**这个生命周期函数来实现。

### 3.Taro与node版本不兼容

taro版本回退

### 4.轮询实现聊天室

使用轮询安全性差，占较多的内存资源与请求数， 非实时，延迟取决于请求间隔。这样使得这个意义不大，不如使用微信好友聊天。

改用websocket实现聊天室。

### 5.ScrollView组件问题

这个组件需要给一个固定高度，因此需要调用一个**onWindowResize**进行监听高度变化

### 6.匹配位置出现问题

通过算法计算定位经纬度周边的活动点。

## 进一步优化

### 1.聊天室优化

为了防止无操作时的自断和网络断开连接时的情况，保证连接的可持续性和稳定性，**可以使用心跳机制**。

心跳机制是每隔一段时间会向服务器发送(send)一个数据包，告诉服务器自己还活着，同时客户端会确认服务器端是否还活着，如果还活着的话，就会回传(message)一个数据包给客户端来确定服务器端也还活着，否则的话，有可能是网络断开连接了，需要重连。

### 2.首页列表渲染优化

- 图片懒加载

- 下拉刷新和上拉加载

**Taro.startPullDownRefresh**()实现下拉刷新。

**ScrollView**组件的**onScrollToLower**事件进行监听，触底之前执行数据请求，没有数据后显示为空的加载显示。

### 3.搜索框优化

- 百度搜索框

- 防抖设置、避免频繁操作引起不必要的数据请求。

### 4.PC端列表数据Skeleton骨架屏

- 在服务器繁忙和网络请求慢的时候，进行一个骨架屏占位，提高用户体验

### 5.文件上传优化

- 切片算法

- 保证稳定性和可靠性而设计重传机制